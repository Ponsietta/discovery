@prefix dcterms: <http://purl.org/dc/terms/> .
@prefix lpd:       <https://discovery.linkedpipes.com/vocabulary/> .
@prefix transformer:  <https://discovery.linkedpipes.com/resource/transformer/dct-issued-to-time-instant/> .
@prefix configuration-vocabulary:  <https://discovery.linkedpipes.com/vocabulary/transformer/dct-issued-to-time-instant/configuration/> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .

transformer:template a lpd:TransformerTemplate ;
	dcterms:title "Dublin Core issued to time instant abstraction"@en;
	dcterms:description "Transforms triples with Dublin Core issued predicate to triples with Dublin Core termporal predicate and objects expressed as Time Instant instance "@en;
	lpd:componentConfigurationTemplate transformer:defaultConfiguration ;
	lpd:inputTemplate transformer:input ;
	lpd:outputTemplate transformer:output ;
	lpd:feature transformer:temporalFeature, transformer:temporalLabelFeature . #Jsou tyto features OK? Obe se totiz aplikuji (appliesTo) na jeden stejny input.
	
configuration-vocabulary:Configuration a rdfs:Class ;
	rdfs:label "Class of configurations of Dublin Core issued to time instant abstraction transformer"@en;
	rdfs:subClassOf lpd:ComponentConfiguration .
	
transformer:defaultConfiguration a configuration-vocabulary:Configuration ;
	dcterms:title "Default configuration" ;
	#nevidim duvod, proc by to mela byt property query z nejakyho specialniho jinyho namespace jako v prikladech, staci ldvm ne?
	lpd:query  """
		PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
		PREFIX dct: <http://purl.org/dc/terms/>
		PREFIX time: <http://www.w3.org/2006/time#>

		DELETE {
		  ?s dct:issued ?dateTime .
		} INSERT {
		  ?s dct:temporal ?instant .
		  
		  ?instant a time:Instant ;
			time:inXSDDateTime ?dateTime ;
			rdfs:label ?abstractionLabel .
		} WHERE {
		  ?s dct:issued ?dateTime .
		  
		  OPTIONAL {
			?s dct:title ?title .
			 BIND(CONCAT("Issuance of ", STR(?title)) AS ?abstractionLabel)
		  }
		  
		  BIND(IRI(CONCAT(STR(?s), "/abstraction/dct-issued-to-time-instant")) AS ?instant)
		}
	""" ;
	#nevidim duvod, proc by se ta property mela jmenovat configurationSPARQL, kdyz vsude jinde se pouziva query a ne SPARQL
	lpd:configurationQuery """
		PREFIX dcterms: <http://purl.org/dc/terms/>
		PREFIX lpd: <https://discovery.linkedpipes.com/vocabulary/>
		PREFIX configuration-vocabulary: <https://discovery.linkedpipes.com/vocabulary/transformer/dct-issued-to-time-instant/configuration/>
		
		CONSTRUCT {
			?config a configuration-vocabulary:Configuration ;
				lpd:query ?query ;
				dcterms:title ?title .
		} WHERE {
			?config a configuration-vocabulary:Configuration .
			OPTIONAL { ?config lpd:query ?query . }
			OPTIONAL { ?config dcterms:title ?title . }
		}
	""" .

transformer:input a lpd:InputDataPortTemplate ;
	dcterms:title "Triples with Dublin Core issued predicate" .
	
transformer:output a lpd:OutputDataPortTemplate ;
	dcterms:title "Representation of objects of the input triples expressed as Time Instant instance linked with the subjects of the input triples by Dublin Core temporal" .
	
transformer:temporalFeature a lpd:MandatoryFeature ;
	dcterms:title "Transforms Dublin Core issued to Time Instant linked by Dublin Core temporal" ;
	lpd:descriptor transformer:temporalDescriptor .
	
transformer:temporalDescriptor a lpd:Descriptor ;
	lpd:query """
		PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
		PREFIX dct: <http://purl.org/dc/terms/>
		PREFIX time: <http://www.w3.org/2006/time#>

		ASK {
		  ?s dct:issued ?dateTime .
		}
	""" ;
	lpd:appliesTo transformer:input .
	
transformer:temporalLabelFeature a lpd:OptionalFeature ;
	dcterms:title "Adds temporal label to the resulting Time Instant" ;
	lpd:descriptor transformer:temporalLabelDescriptor .
	
transformer:temporalLabelDescriptor a lpd:Descriptor ;
	lpd:query """
		PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
		PREFIX dct: <http://purl.org/dc/terms/>
		PREFIX time: <http://www.w3.org/2006/time#>

		ASK {
		  ?s dct:issued ?dateTime ;
		     dct:title ?title .
		}
	""" ;
	lpd:appliesTo transformer:input .
